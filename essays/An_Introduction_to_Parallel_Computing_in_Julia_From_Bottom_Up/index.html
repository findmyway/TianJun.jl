<!DOCTYPE html>
<html lang="en-US"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>è‡ªåº•å‘ä¸Šç†è§£Juliaä¸­çš„å¹¶è¡Œè®¡ç®— Â· Jun Tian</title><meta name="title" content="è‡ªåº•å‘ä¸Šç†è§£Juliaä¸­çš„å¹¶è¡Œè®¡ç®— Â· Jun Tian"/><meta property="og:title" content="è‡ªåº•å‘ä¸Šç†è§£Juliaä¸­çš„å¹¶è¡Œè®¡ç®— Â· Jun Tian"/><meta property="twitter:title" content="è‡ªåº•å‘ä¸Šç†è§£Juliaä¸­çš„å¹¶è¡Œè®¡ç®— Â· Jun Tian"/><meta name="description" content="Documentation for Jun Tian."/><meta property="og:description" content="Documentation for Jun Tian."/><meta property="twitter:description" content="Documentation for Jun Tian."/><script async src="https://www.googletagmanager.com/gtag/js?id=UA-132847825-3"></script><script>  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'UA-132847825-3', {'page_path': location.pathname + location.search + location.hash});
</script><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../search_index.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script><link href="../../assets/favicon.ico" rel="icon" type="image/x-icon"/><link href="../../assets/custom.css" rel="stylesheet" type="text/css"/></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../"><img src="../../assets/logo.jpg" alt="Jun Tian logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../../">Jun Tian</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../">ğŸ‘‹ About</a></li><li><span class="tocitem">ğŸ’» Programming</span><ul><li><a class="tocitem" href="../../programming/A_Deep_Dive_into_Distributed.jl/">A Deep Dive into Distributed.jl</a></li></ul></li><li><span class="tocitem">ğŸ“– Reading</span><ul><li><a class="tocitem" href="../../reading/Notes_on_Distributional_Reinforcement_Learning/">Notes on Distributional Reinforcement Learning</a></li></ul></li><li><a class="tocitem" href="../../AMA/">ğŸ™‹ Ask Me Anything</a></li><li><a class="tocitem" href="../../blogroll/">ğŸ”— Blogroll</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>è‡ªåº•å‘ä¸Šç†è§£Juliaä¸­çš„å¹¶è¡Œè®¡ç®—</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>è‡ªåº•å‘ä¸Šç†è§£Juliaä¸­çš„å¹¶è¡Œè®¡ç®—</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/findmyway/TianJun.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands">ï‚›</span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/findmyway/TianJun.jl/blob/master/docs/src/essays/An_Introduction_to_Parallel_Computing_in_Julia_From_Bottom_Up/index.md" title="Edit source on GitHub"><span class="docs-icon fa-solid">ï„</span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><hr/><p>keywords: ParallelComputing,Julia CJKmainfont: KaiTi â€“-</p><h1 id="è‡ªåº•å‘ä¸Šç†è§£Juliaä¸­çš„å¹¶è¡Œè®¡ç®—"><a class="docs-heading-anchor" href="#è‡ªåº•å‘ä¸Šç†è§£Juliaä¸­çš„å¹¶è¡Œè®¡ç®—">è‡ªåº•å‘ä¸Šç†è§£Juliaä¸­çš„å¹¶è¡Œè®¡ç®—</a><a id="è‡ªåº•å‘ä¸Šç†è§£Juliaä¸­çš„å¹¶è¡Œè®¡ç®—-1"></a><a class="docs-heading-anchor-permalink" href="#è‡ªåº•å‘ä¸Šç†è§£Juliaä¸­çš„å¹¶è¡Œè®¡ç®—" title="Permalink"></a></h1><p>æœ€è¿‘çœ‹åˆ°ä¸€äº›æœ‰å…³Juliaå¹¶è¡Œè®¡ç®—çš„æé—®ï¼Œæ‰€ä»¥è¿™é‡Œä¸å¦¨å¼€ä¸ªå¤´ï¼Œä»‹ç»ä¸‹Juliaä¸­å¹¶è¡Œè®¡ç®—çš„å®ç°ï¼Œå¸Œæœ›èƒ½æœ‰æ›´å¤šäººèƒ½å‚ä¸è¿›æ¥ä¸€èµ·è®¨è®ºã€‚åœ¨Juliaæ–‡æ¡£ä¸­ï¼Œæœ‰ä¸“é—¨çš„ä¸€éƒ¨åˆ†è®²è§£<a href="https://docs.julialang.org/en/stable/manual/parallel-computing/">Parallel Computing</a>(ä¸­æ–‡ç¿»è¯‘è§<a href="http://docs.juliacn.com/latest/manual/parallel-computing/">å¹¶è¡Œè®¡ç®—</a>)ï¼Œé‡‡ç”¨çš„æ˜¯ä¸€ç§Top-Downçš„æ–¹å¼åˆ†åˆ«ä»‹ç»äº†åç¨‹ã€å¤šçº¿ç¨‹åŠåˆ†å¸ƒå¼å¤„ç†ã€‚è¿™é‡Œæˆ‘æ‰“ç®—é‡‡ç”¨ä¸€ç§Bottom-Upçš„æ–¹å¼æ¥ä»‹ç»ä¸‹Juliaä¸­çš„å¹¶è¡Œè®¡ç®—ï¼Œå»ºè®®å…ˆè¯»å®Œå®˜æ–¹æ–‡æ¡£åç»§ç»­å¾€ä¸‹çœ‹ã€‚</p><h2 id="å‡ ä¸ªåŸºæœ¬æ¦‚å¿µ"><a class="docs-heading-anchor" href="#å‡ ä¸ªåŸºæœ¬æ¦‚å¿µ">å‡ ä¸ªåŸºæœ¬æ¦‚å¿µ</a><a id="å‡ ä¸ªåŸºæœ¬æ¦‚å¿µ-1"></a><a class="docs-heading-anchor-permalink" href="#å‡ ä¸ªåŸºæœ¬æ¦‚å¿µ" title="Permalink"></a></h2><h3 id="Task"><a class="docs-heading-anchor" href="#Task"><code>Task</code></a><a id="Task-1"></a><a class="docs-heading-anchor-permalink" href="#Task" title="Permalink"></a></h3><p>é¡¾åæ€ä¹‰ï¼Œ<code>Task</code>å°±æ˜¯æ„é€ ä¸€æ®µæ‰§è¡Œä»»åŠ¡ï¼Œ<code>Task</code>çš„å®šä¹‰åœ¨<a href="https://github.com/JuliaLang/julia/blob/master/src/task.c">task.c</a>æ–‡ä»¶ä¸­ï¼Œä¸è¿‡ä½œä¸ºä½¿ç”¨è€…ï¼Œæˆ‘ä»¬æ›´å…³å¿ƒçš„æ˜¯è°ƒç”¨æ¥å£ï¼š</p><pre><code class="language-julia hljs">julia&gt; methods(Task)
# 1 method for generic function &quot;(::Type)&quot;:
[1] Task(f) in Core at boot.jl:377

julia&gt; methodswith(Task)
[1] bind(c::Channel, task::Task) in Base at channels.jl:191
[2] serialize(s::Serialization.AbstractSerializer, t::Task) in Serialization at /buildworker/worker/package_linux64/build/usr/share/julia/stdlib/v1.0/Serialization/src/Serialization.jl:427
[3] fetch(t::Task) in Base at task.jl:202
[4] istaskdone(t::Task) in Base at task.jl:117
[5] istaskstarted(t::Task) in Base at task.jl:134
[6] schedule(t::Task) in Base at event.jl:95
[7] schedule(t::Task, arg) in Base at event.jl:129
[8] show(io::IO, ::MIME{Symbol(&quot;text/plain&quot;)}, t::Task) in Base at show.jl:150
[9] show(io::IO, t::Task) in Base at task.jl:58
[10] wait(t::Task) in Base at task.jl:182
[11] yield(t::Task) in Base at event.jl:166
[12] yield(t::Task, x) in Base at event.jl:166
[13] yieldto(t::Task) in Base at event.jl:181
[14] yieldto(t::Task, x) in Base at event.jl:181

julia&gt; fieldnames(Task)
(:parent, :storage, :state, :donenotify, :result, :exception, :backtrace, :logstate, :code)</code></pre><p>taskçš„æ„é€ å‡½æ•°åªæœ‰ä¸€ä¸ª<code>Task(f)</code>ï¼Œå…¶å”¯ä¸€çš„ä¸€ä¸ªå‚æ•°<code>f</code>å¿…é¡»æ˜¯ä¸å¸¦å‚æ•°çš„å‡½æ•°ï¼Œå¦‚æœä¼ ä¸€ä¸ªå¸¦å‚æ•°çš„å‡½æ•°ï¼Œä¼šåœ¨çœŸæ­£æ‰§è¡Œæ—¶è§¦å‘<code>MethodError</code>ã€‚</p><pre><code class="language-julia hljs">julia&gt; t = Task((x) -&gt; x + 1)
Task (runnable) @0x00007f600e180d30

julia&gt; schedule(t)
Task (failed) @0x00007f600e180d30
MethodError: no method matching (::getfield(Main, Symbol(&quot;##11#12&quot;)))()
Closest candidates are:
  #11(::Any) at REPL[29]:1</code></pre><p>å½“ç„¶ï¼Œæ¯æ¬¡éƒ½è¦è®°å¾—æ„é€ ä¸€ä¸ªé—­åŒ…å¾ˆå‚»ï¼Œæœ‰ä¸€ä¸ª<code>@task</code>å®å¯ä»¥ç”¨äºç®€åŒ–è¿™ä¸ªè¿‡ç¨‹ï¼š</p><pre><code class="language-julia hljs">julia&gt; t = @task println(&quot;Hi&quot;)
Task (runnable) @0x00007f600f25aa10

julia&gt; schedule(t)
Hi
Task (queued) @0x00007f600f25aa10

julia&gt; t
Task (done) @0x00007f600f25aa10</code></pre><p>ä¸Šé¢ä¸ºäº†çœ‹åˆ°ä¸€ä¸ªtaskçš„æ‰§è¡Œç»“æœï¼Œæˆ‘ä»¬ä½¿ç”¨äº†<code>schedule</code>å‡½æ•°ï¼Œå…¶ä½œç”¨æ˜¯å°†è¿™ä¸ªrunnableçš„taskåŠ å…¥åˆ°ä¸€ä¸ªå…¨å±€çš„taské˜Ÿåˆ—ä¸­ï¼Œç„¶åå°†taskçš„çŠ¶æ€ç½®æˆ<code>:queued</code>ï¼Œç³»ç»Ÿåœ¨<strong>ç©ºé—²</strong>æ—¶ä¼šæ‰§è¡Œè¯¥taskï¼ˆTODO:è°ƒåº¦çš„é€»è¾‘ï¼‰ï¼Œæ‰§è¡Œç»“æœå­˜åœ¨<code>:result</code>å­—æ®µä¸‹ï¼Œå¹¶æ ¹æ®æ‰§è¡Œç»“æœä¿®æ”¹å…¶<code>:state</code>çŠ¶æ€ï¼ˆ<code>:failed</code>,<code>:done</code>ï¼‰ã€‚ä¸è¿‡ä¸Šé¢çš„ä¾‹å­ä¼¼ä¹ç»™äººä¸€ç§é”™è§‰ï¼Œåœ¨æ‰§è¡Œå®Œ<code>schedule(t)</code>ä¹‹åï¼Œtask <code>t</code>ç«‹å³å°±æ‰§è¡Œäº†ï¼Œå¹¶æ²¡æœ‰æ„Ÿå—åˆ°æ‰€è°“çš„<strong>ç­‰å¾…ç³»ç»Ÿç©ºé—²</strong>ã€‚ä¸‹é¢è¿™ä¸ªä¾‹å­ç”¨ä¸€ä¸ªè®¡ç®—å¯†é›†å‹çš„ä»»åŠ¡æ¥éªŒè¯ä¸‹ï¼š</p><pre><code class="language-julia hljs">t = @task begin 
    println(&quot;begin task&quot;)
    inv(rand(2000, 2000))
    println(&quot;end task&quot;) 
    end

begin 
    schedule(t)
    println(length(Base.Workqueue))
    println(t.state)
    println(&quot;begin computing&quot;)
    println(sum(inv(randn(1500, 1500))))
    println(&quot;end computing&quot;)
    println(length(Base.Workqueue))
    println(t.state)
end

# 1
# queued
# begin computing
# 97.12983082590253
# end computing
# 1
# queued
# begin task
# end task</code></pre><p>å¯ä»¥çœ‹åˆ°ï¼Œåœ¨<code>schedule(t)</code>ä¹‹åï¼Œ<code>t</code>å¹¶æ²¡æœ‰ç«‹å³è¢«æ‰§è¡Œï¼Œè€Œæ˜¯è¢«æ·»åŠ åˆ°äº†<code>Base.Workqueue</code>ä¸­ä¸€ç›´å¤„äº<code>queued</code>çŠ¶æ€ï¼Œä¸»æµç¨‹ç»§ç»­æ‰§è¡Œï¼Œå…ˆè¿›è¡Œäº†æ±‚é€†è®¡ç®—ï¼Œç»“æŸä¹‹åï¼Œç³»ç»Ÿå†è¿›è¡Œtaskåˆ‡æ¢ï¼Œæ‰§è¡Œ<code>t</code>ã€‚ä»¥ä¸Šï¼Œå°±æ˜¯æ‰€è°“çš„<strong>å¹¶å‘(Concurrency)</strong>ã€‚å¯¹äºå•ä¸€è¿›ç¨‹æ¥è¯´ï¼Œå¹¶å‘æ‰§è¡Œè®¡ç®—å¯†é›†å‹ä»»åŠ¡å¹¶æ²¡æœ‰å¤ªå¤§æ”¶ç›Šï¼Œä¸è¿‡ï¼Œå¯¹IOå¯†é›†å‹ä»»åŠ¡æ¥è¯´ï¼Œåˆ™éå¸¸æœ‰ç”¨ï¼Œåœ¨ç­‰å¾…çš„è¿‡ç¨‹ä¸­ï¼Œå¯ä»¥åˆ‡æ¢åˆ°å…¶å®ƒä»»åŠ¡ï¼Œä¸€æ—¦æ¡ä»¶æ»¡è¶³ï¼Œå†åˆ‡å›æ¥å°±æ‰§è¡Œï¼Œè¿™æ ·çœ‹èµ·æ¥ï¼Œä¼¼ä¹æ˜¯åœ¨åŒæ—¶æ‰§è¡Œå¤šä¸ªä»»åŠ¡ï¼ˆå¹¶å‘ï¼‰ã€‚Juliaå¯¹è¿™é‡Œæ‰€è°“çš„æ¡ä»¶æä¾›äº†ä¸€ä¸ªç»Ÿä¸€çš„æ¦‚å¿µï¼Œç§°ä¸º<code>Condition()</code>:</p><pre><code class="language-julia hljs">julia&gt; fieldnames(Condition)
(:waitq,)</code></pre><p><code>Condition()</code>åªæœ‰ä¸€ä¸ªç±»å‹ä¸º<code>Vector</code>çš„å­—æ®µ<code>:waitq</code>ç”¨äºè®°å½•åœ¨ç­‰å¾…è¯¥æ¡ä»¶çš„æ‰€æœ‰taskï¼Œåœ¨ä¸€ä¸ªtaskå†…éƒ¨ï¼Œå¯ä»¥é€šè¿‡æ‰§è¡Œ<code>wait(c::Condition)</code>ï¼Œå£°æ˜å…¶æ­£åœ¨ç­‰å¾…æŸä¸ªæ¡ä»¶ï¼Œç„¶åå°†è‡ªå·±æ·»åŠ åˆ°<code>Base.Workqueue</code>å°¾éƒ¨ï¼ŒåŒæ—¶ä»ä¸­å–å‡ºç¬¬ä¸€ä¸ªtaskå¹¶åšåˆ‡æ¢ã€‚å½“æ¡ä»¶æ»¡è¶³æ—¶ï¼Œé€šè¿‡æ‰§è¡Œ<code>notify(c::Condition)</code>å†å°†è¿™äº›taské‡æ–°åŠ å…¥åˆ°<code>Base.Workqueue</code>ä¸­ç­‰å¾…æ‰§è¡Œã€‚</p><pre><code class="language-julia hljs">julia&gt; c = Condition()
Condition(Any[])

julia&gt; t = @task begin
           println(&quot;waiting condition&quot;)
           wait(c)
           println(&quot;condition meet&quot;)
           end
Task (runnable) @0x00007f2d954c07f0

julia&gt; schedule(t)
waiting condition
Task (queued) @0x00007f2d954c07f0

julia&gt; notify(c)
condition meet
1</code></pre><p>é™¤äº†é€šè¿‡æ‰§è¡Œ<code>wait</code>è¿›è¡Œtaskåˆ‡æ¢ä¹‹å¤–ï¼Œè¿˜å¯ä»¥é€šè¿‡æ‰§è¡Œ<code>yield()</code>ä¸»åŠ¨è¿›è¡Œ<code>task</code>çš„åˆ‡æ¢ï¼ˆå…¶å®ä¹Ÿæ˜¯è°ƒç”¨äº†<code>wait()</code>å‡½æ•°ï¼‰ã€‚</p><pre><code class="language-julia hljs">yield() = (enq_work(current_task()); wait())</code></pre><p>ä¸‹é¢çœ‹ä¸€ä¸ª<code>yield</code>çš„ä¾‹å­ï¼š</p><pre><code class="language-julia hljs">julia&gt; t1 = @task begin
       println(&quot;task1 begin&quot;)
       yield()
       println(&quot;task1 resumed&quot;)
       end
Task (runnable) @0x00007f2d954c2f50

julia&gt; t2 = @task begin
       println(&quot;task2 begin&quot;)
       yield()
       println(&quot;task2 resumed&quot;)
       end
Task (runnable) @0x00007f2d954c31f0

julia&gt; begin
       schedule(t1)
       schedule(t2)
       yield()
       end
task1 begin
task2 begin
task1 resumed
task2 resumed</code></pre><p>å…³äºtaskï¼Œç†è§£è¿™äº›åŸºæœ¬å¤Ÿç”¨äº†ã€‚ä¸€ä¸ªå…¸å‹çš„åº”ç”¨æ˜¯<code>Timer</code>ï¼Œå…¶ä¸­æœ‰ä¸ªå­—æ®µ<code>:cond</code>å°±æ˜¯ä¸€ä¸ª<code>Condition()</code>ï¼Œæ¯å½“è®¾å®šçš„æ—¶é—´å‘¨æœŸåˆ°äº†çš„æ—¶å€™ï¼Œå°±ä¼š<code>notify</code>æŒ‚åœ¨è¯¥<code>:cond</code>ä¸Šçš„taskã€‚å¦å¤–ç»å¸¸ç”¨åˆ°çš„<code>@async</code>å®å…¶å®å°±æ˜¯å…ˆæ„é€ äº†ä¸€ä¸ªtaskï¼Œç„¶åæ‰§è¡Œäº†<code>schedule</code>ï¼ˆäºŒåˆä¸€äº†ï¼‰</p><p>ä¸‹é¢æˆ‘ä»¬å†æ·±å…¥ç†è§£ä¸€ä¸ªæ›´æœ‰æ„æ€çš„ä¾‹å­ã€‚</p><h3 id="Channel"><a class="docs-heading-anchor" href="#Channel"><code>Channel</code></a><a id="Channel-1"></a><a class="docs-heading-anchor-permalink" href="#Channel" title="Permalink"></a></h3><p><code>Channel</code>å°±æ˜¯ä¸€ä¸ªé€šé“ï¼Œä¸åŒçš„taskå¯ä»¥ä»ä¸€ç«¯å¾€å…¶ä¸­å†™å…¥æ•°æ®ï¼Œè€Œå¦å¤–ä¸€äº›taskåˆ™å¯ä»¥ä»å¦å¤–ä¸€ç«¯è¯»å–æ•°æ®ã€‚<code>Channel</code>çš„ç»“æ„å¾ˆç®€å•ï¼š</p><pre><code class="language-julia hljs">mutable struct Channel{T} &lt;: AbstractChannel{T}
    cond_take::Condition                 # waiting for data to become available
    cond_put::Condition                  # waiting for a writeable slot
    state::Symbol
    excp::Union{Exception, Nothing}         # exception to be thrown when state != :open

    data::Vector{T}
    sz_max::Int                          # maximum size of channel

    # Used when sz_max == 0, i.e., an unbuffered channel.
    waiters::Int
    takers::Vector{Task}
    putters::Vector{Task}
end</code></pre><p>å…¶ä¸­<code>state</code>å­—æ®µè¡¨ç¤ºå½“å‰channelçš„çŠ¶æ€ï¼ˆ<code>:open</code>, <code>:closed</code>ï¼‰,<code>sz_max</code>åˆ™è¡¨ç¤ºchannelçš„é•¿åº¦ï¼ˆè¯¥é•¿åº¦å¯ä»¥è®¾ä¸º0ï¼Œ~~å³æ— é™å¤§~~ï¼‰ã€‚</p><p>å¯¹äºé•¿åº¦æœ‰é™çš„channelæ¥è¯´ï¼Œæ‰§è¡Œ<code>put!(c, v)</code>å†™å…¥æ•°æ®æ—¶ï¼Œå¦‚æœå½“å‰<code>data</code>çš„é•¿åº¦å·²ç»è¾¾åˆ°äº†<code>sz_max</code>ï¼Œåˆ™ä¼šè°ƒç”¨<code>wait()</code>å°†å½“å‰taské˜»å¡ï¼Œç„¶åæ¯ä¸ªäº‹ä»¶å‘¨æœŸéƒ½ä¼šæ£€æŸ¥<code>data</code>çš„é•¿åº¦æ˜¯å¦å·²ç»å°äº<code>sz_max</code>ï¼Œä¸€æ—¦è¯¥æ¡ä»¶æ»¡è¶³ï¼Œå°±ä¼šå¾€<code>data</code>ä¸­å†™å…¥<code>v</code>ï¼ŒåŒæ—¶é€šçŸ¥æ‰€æœ‰æŒ‚åœ¨<code>cond_take</code>å­—æ®µä¸Šçš„taskã€‚è€Œæ‰§è¡Œ<code>take!(c)</code>è¯»å–æ•°æ®æ—¶ï¼Œå¦‚æœå½“å‰<code>data</code>ä¸­æœ‰æ•°æ®ï¼Œåˆ™å–å‡ºæ¥ï¼ŒåŒæ—¶é€šçŸ¥æŒ‚åœ¨<code>cond_put</code>ä¸Šçš„taskï¼Œå¦åˆ™ï¼Œå°†å½“å‰taskæŒ‚èµ·åˆ°<code>cond_take</code>ä¸­ï¼Œç­‰å¾…æ–°çš„æ•°æ®ã€‚</p><p>å¯¹äº~~æ— é™é•¿~~é•¿åº¦ä¸º0çš„channelè€Œè¨€ï¼Œéœ€è¦ç”¨åˆ°<code>takers</code>å’Œ<code>putters</code>å­—æ®µã€‚åœ¨å†™å…¥æ•°æ®æ—¶ï¼Œå¦‚æœ<code>takers</code>ä¸ºç©ºï¼Œå°±å°†å½“å‰taskå†™å…¥åˆ°<code>putters</code>ä¸­(ç„¶åè¿˜ä¼šé€šçŸ¥<code>cond_take</code>ä¸Šçš„taskï¼Œè¿™ç±»taskæ˜¯é€šè¿‡<code>wait(c)</code>æŒ‚åœ¨åœ¨~~æ— é™é•¿~~channelä¸Šçš„)ï¼Œå¦åˆ™ï¼Œä»<code>takers</code>ä¸­å–ä¸€ä¸ªå‡ºæ¥<strong>é‡æ–°</strong>æ‰§è¡Œï¼ˆè¿™é‡Œç”¨çš„æ˜¯<code>yield(t, v)</code>æ“ä½œï¼‰ã€‚å–æ•°æ®æ—¶ï¼Œå…ˆå°†è‡ªå·±åŠ å…¥åˆ°<code>waiters</code>ä¸­ï¼Œç„¶ååˆ¤æ–­<code>putters</code>æ˜¯å¦ä¸ºç©ºï¼Œè‹¥ç©ºï¼Œåˆ™è°ƒç”¨<code>wait()</code>å°†è‡ªå·±æŒ‚èµ·ï¼Œå¦åˆ™ä»<code>putters</code>ä¸­å–å‡ºä¸€ä¸ªæ‰§è¡Œã€‚</p><p>æ­¤å¤–ï¼Œå…³äº<code>Channel</code>æœ‰ä¸ªæŒºå¥½ç”¨çš„å‡½æ•°<code>Channel(func::Function; ctype=Any, csize=0, taskref=nothing)</code>ã€‚å…³äº<code>Channel</code>çš„ä¾‹å­å®åœ¨å¤ªå¤šäº†ï¼Œæ‰‹å†Œä¸­çš„é‚£ä¸ªç”Ÿäº§è€…æ¶ˆè´¹è€…çš„ä¾‹å­å°±æŒºä¸é”™çš„ï¼Œè¿™é‡Œä¸åˆ—ä¸¾äº†ã€‚</p><h2 id="å¤šçº¿ç¨‹"><a class="docs-heading-anchor" href="#å¤šçº¿ç¨‹">å¤šçº¿ç¨‹</a><a id="å¤šçº¿ç¨‹-1"></a><a class="docs-heading-anchor-permalink" href="#å¤šçº¿ç¨‹" title="Permalink"></a></h2><p>è¿™é‡Œæš‚æ—¶å…ˆä¸æ·±å…¥ä»‹ç»å¤šçº¿ç¨‹ï¼Œä¸»è¦æ˜¯è¿™ä¸ªJuliaä¸­è€å¤§éš¾çš„é—®é¢˜äº†ï¼Œç›®å‰çš„æ¥å£ä»ç„¶æ˜¯å®éªŒæ€§çš„ï¼Œæ­¤å¤–ä¹Ÿæœ‰ä¸€äº›PRæ­£åœ¨åšè¿™æ–¹é¢çš„äº‹æƒ…ï¼Œå»ºè®®subscribeä¸€äº›<a href="https://github.com/JuliaLang/julia/labels/multithreading">multithreading</a>çš„PRï¼Œäº†è§£ä¸‹æœ€æ–°çš„è¿›å±•ï¼ˆæ¯”å¦‚<a href="https://github.com/JuliaLang/julia/pull/22631">è¿™ä¸ª</a>ï¼‰</p><h2 id="å¤šè¿›ç¨‹"><a class="docs-heading-anchor" href="#å¤šè¿›ç¨‹">å¤šè¿›ç¨‹</a><a id="å¤šè¿›ç¨‹-1"></a><a class="docs-heading-anchor-permalink" href="#å¤šè¿›ç¨‹" title="Permalink"></a></h2><p>å‰é¢æåˆ°çš„éƒ½è¿˜æ˜¯<strong>å¹¶å‘</strong>ï¼Œè¦å®ç°çœŸæ­£çš„<strong>å¹¶è¡Œ</strong>ï¼Œéœ€è¦å……åˆ†åˆ©ç”¨å¤šæ ¸/å¤šå°æœºå™¨ã€‚æ‰‹å†Œé‡Œæœ‰æåˆ°ï¼ŒJuliaå®ç°çš„å¹¶è¡Œæœºåˆ¶æœ‰ç‚¹ç±»ä¼¼MPIï¼Œä¸è¿‡æ˜¯å•å‘çš„ï¼ˆä¹Ÿå°±æ˜¯è¯´ï¼Œæœ‰ä¸€ä¸ªmasterè¿›ç¨‹è´Ÿè´£ç»™å…¶å®ƒè¿›ç¨‹åˆ†é…æ‰§è¡Œä»»åŠ¡ï¼‰ã€‚æ‰€æœ‰åˆ†å¸ƒå¼ç›¸å…³çš„ä»£ç éƒ½åœ¨Juliaæºç çš„<code>stdlib/Distributed</code>packageä¸‹ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬ä¸€æ­¥æ­¥å±•å¼€ä»‹ç»ï¼ˆå¦‚æœä½ æƒ³åœ¨REPLä¸­æµ‹è¯•ä¸‹é¢çš„ç¤ºä¾‹ä»£ç ï¼Œè®°å¾—å…ˆæ‰§è¡Œ<code>using Distributed</code>ï¼‰ã€‚</p><p>é¦–å…ˆè®¨è®ºå•æœºå¤šè¿›ç¨‹çš„æƒ…å†µã€‚åœ¨Juliaä¸­ï¼Œä¸€ä¸ªå·¥ä½œè¿›ç¨‹ç§°ä½œä¸€ä¸ªworkerï¼Œç®¡ç†è¿™äº›workerçš„è¿›ç¨‹æ˜¯<code>LocalProcess</code>ï¼ˆä¹Ÿå°±æ˜¯æ‰“å¼€REPLåè¿›å…¥çš„è¿›ç¨‹ï¼‰ã€‚æ¯ä¸ªè¿›ç¨‹éƒ½æœ‰è‡ªå·±çš„pidï¼Œ<code>LocalProcess</code>çš„pidæ˜¯<code>1</code>ï¼ˆä¸ºäº†è¡¨è¿°æ–¹ä¾¿ï¼Œä»¥ä¸‹ç§°å…¶ä¸ºmasterï¼‰ã€‚æ¥ä¸‹æ¥å…ˆå›ç­”å‡ ä¸ªé—®é¢˜ï¼š</p><h3 id="1.-å¦‚ä½•è¡¨ç¤ºä¸€ä¸ªworkä¸­çš„å¯¹è±¡ï¼Ÿ"><a class="docs-heading-anchor" href="#1.-å¦‚ä½•è¡¨ç¤ºä¸€ä¸ªworkä¸­çš„å¯¹è±¡ï¼Ÿ">1. å¦‚ä½•è¡¨ç¤ºä¸€ä¸ªworkä¸­çš„å¯¹è±¡ï¼Ÿ</a><a id="1.-å¦‚ä½•è¡¨ç¤ºä¸€ä¸ªworkä¸­çš„å¯¹è±¡ï¼Ÿ-1"></a><a class="docs-heading-anchor-permalink" href="#1.-å¦‚ä½•è¡¨ç¤ºä¸€ä¸ªworkä¸­çš„å¯¹è±¡ï¼Ÿ" title="Permalink"></a></h3><p>å¯¹äºmasterè€Œè¨€ï¼Œworkerä¸­çš„å¯¹è±¡æœ‰ä¸¤ç§è¡¨ç¤ºï¼Œä¸€ä¸ªæ˜¯<code>Future</code>ï¼Œå¦ä¸€ä¸ªæ˜¯<code>RemoteChannel</code>ã€‚</p><pre><code class="language-julia hljs">mutable struct Future &lt;: AbstractRemoteRef
    where::Int
    whence::Int
    id::Int
    v::Union{Some{Any}, Nothing}
end</code></pre><p>å…¶ä¸­ï¼Œ<code>where</code>è¡¨ç¤º<code>v</code>æ‰€åœ¨çš„pidï¼Œ<code>whence</code>å’Œ<code>id</code>ä¸€èˆ¬é€šè¿‡<code>RRID</code>ç”Ÿæˆï¼Œåˆ†åˆ«è¡¨ç¤ºç”Ÿæˆè¯¥<code>Future</code>å¯¹è±¡çš„è¿›ç¨‹çš„pidï¼Œè€Œ<code>id</code>åˆ™æ˜¯ä»1å¼€å§‹è‡ªå¢çš„idã€‚<code>RemoteChannel</code>ä¹Ÿç±»ä¼¼ï¼š</p><pre><code class="language-julia hljs">mutable struct RemoteChannel{T&lt;:AbstractChannel} &lt;: AbstractRemoteRef
    where::Int
    whence::Int
    id::Int
end</code></pre><h3 id="2.-æ€ä¹ˆå‘èµ·è¿œç¨‹è°ƒç”¨ï¼Ÿ"><a class="docs-heading-anchor" href="#2.-æ€ä¹ˆå‘èµ·è¿œç¨‹è°ƒç”¨ï¼Ÿ">2. æ€ä¹ˆå‘èµ·è¿œç¨‹è°ƒç”¨ï¼Ÿ</a><a id="2.-æ€ä¹ˆå‘èµ·è¿œç¨‹è°ƒç”¨ï¼Ÿ-1"></a><a class="docs-heading-anchor-permalink" href="#2.-æ€ä¹ˆå‘èµ·è¿œç¨‹è°ƒç”¨ï¼Ÿ" title="Permalink"></a></h3><p>Juliaä¸­ï¼Œæä¾›äº†ä¸€ä¸ªåº•å±‚å‡½æ•°<code>remotecall</code>æ¥å®ç°è¿œç¨‹è°ƒç”¨ï¼Œæ‰§è¡Œåä¼šç«‹å³è¿”å›ä¸€ä¸ª<code>Future</code>å¯¹è±¡ï¼Œç„¶åå¯ä»¥é€šè¿‡<code>fetch</code>å°†valueå†™å…¥åˆ°<code>Future</code>çš„<code>v</code>å­—æ®µä¸­ï¼ˆæ­¤æ—¶ä¼šå‘ç”Ÿæ•°æ®è½¬ç§»ï¼Œä¹Ÿå°±æ˜¯å¯¼è‡´å¹¶è¡Œè®¡ç®—æ€§èƒ½ç“¶é¢ˆçš„åœ°æ–¹ï¼‰ã€‚ä¾‹å¦‚ï¼š</p><pre><code class="language-julia hljs">julia&gt; using Distributed

julia&gt; addprocs()
4-element Array{Int64,1}:
 2
 3
 4
 5

julia&gt; m = remotecall(rand, 5, 2, 2)
Future(5, 1, 6, nothing)

julia&gt; fetch(m)
2Ã—2 Array{Float64,2}:
 0.109123  0.304667
 0.454125  0.197551</code></pre><p>æ­¤å¤–ï¼Œ<code>Distributed</code>ä¸­è¿˜æä¾›äº†ä¸€äº›å·¥å…·å‡½æ•°å’Œæœ‰ç”¨çš„å®ï¼Œè¿™é‡Œä¸æ·±å…¥ä»‹ç»ï¼Œæˆ‘ä»¬æ›´å…³å¿ƒçš„æ˜¯ï¼š</p><h3 id="3.-ä»€ä¹ˆæ—¶å€™ä¼šå‘ç”ŸGCï¼Ÿ"><a class="docs-heading-anchor" href="#3.-ä»€ä¹ˆæ—¶å€™ä¼šå‘ç”ŸGCï¼Ÿ">3. ä»€ä¹ˆæ—¶å€™ä¼šå‘ç”ŸGCï¼Ÿ</a><a id="3.-ä»€ä¹ˆæ—¶å€™ä¼šå‘ç”ŸGCï¼Ÿ-1"></a><a class="docs-heading-anchor-permalink" href="#3.-ä»€ä¹ˆæ—¶å€™ä¼šå‘ç”ŸGCï¼Ÿ" title="Permalink"></a></h3><p><code>Distributed</code>ä¸­æœ‰ä¸€ä¸ª<code>clear!</code>å‡½æ•°ç”¨äºå°†workerä¸­çš„å˜é‡ç½®æˆnothingï¼Œä¸è¿‡ï¼Œå¦‚æœä¸å¼•å…¥å…¨å±€å˜é‡çš„è¯ï¼Œå¤§å¤šæ—¶å€™å¹¶ä¸éœ€è¦æ‰‹åŠ¨è¿›è¡Œè¯¥æ“ä½œã€‚<code>fetch</code>ä¼šè‡ªåŠ¨æ‰§è¡Œ<code>send_del_client</code>å‡½æ•°ï¼Œå¹¶é€šçŸ¥gc.æ­¤å¤–æ‰‹å†Œé‡Œä¹Ÿæåˆ°ï¼Œç”±äºå¯¹masteræ¥è¯´ï¼Œä¸€ä¸ªRemoteReferenceçš„å†…å­˜å ç”¨å¾ˆå°ï¼Œå¹¶ä¸ä¼šé©¬ä¸Šè¢«gcï¼Œå› è€Œå¯ä»¥è°ƒç”¨<code>finalize</code>ï¼Œä»è€Œä¼šç«‹å³æ‰§è¡Œ<code>send_del_client</code>å‘workerå‘é€gcä¿¡å·ã€‚</p><p>TODO: ä¸€ä¸ªåˆ†å¸ƒå¼å¹¶è¡Œè®¡ç®—çš„å®ä¾‹</p></article><nav class="docs-footer"><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>. All contents published at this site follows <a href="https://creativecommons.org/licenses/by/4.0/">CC-BY-4.0</a> by default. For the Chinese version, please visit <a href="https://tianjun.me">tianjun.me</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="auto">Automatic (OS)</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.2.1 on <span class="colophon-date" title="Saturday 23 December 2023 15:51">Saturday 23 December 2023</span>. Using Julia version 1.9.4.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
