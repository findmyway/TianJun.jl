<!DOCTYPE html>
<html lang="en-US"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Write Python in Lisp · Jun Tian</title><meta name="title" content="Write Python in Lisp · Jun Tian"/><meta property="og:title" content="Write Python in Lisp · Jun Tian"/><meta property="twitter:title" content="Write Python in Lisp · Jun Tian"/><meta name="description" content="Documentation for Jun Tian."/><meta property="og:description" content="Documentation for Jun Tian."/><meta property="twitter:description" content="Documentation for Jun Tian."/><script async src="https://www.googletagmanager.com/gtag/js?id=UA-132847825-3"></script><script>  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'UA-132847825-3', {'page_path': location.pathname + location.search + location.hash});
</script><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../search_index.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script><link href="../../assets/favicon.ico" rel="icon" type="image/x-icon"/><link href="../../assets/custom.css" rel="stylesheet" type="text/css"/></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../"><img src="../../assets/logo.jpg" alt="Jun Tian logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../../">Jun Tian</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../">👋 About</a></li><li><span class="tocitem">💻 Programming</span><ul><li><a class="tocitem" href="../../programming/A_Deep_Dive_into_Distributed.jl/">A Deep Dive into Distributed.jl</a></li></ul></li><li><span class="tocitem">📖 Reading</span><ul><li><a class="tocitem" href="../../reading/Notes_on_Distributional_Reinforcement_Learning/">Notes on Distributional Reinforcement Learning</a></li></ul></li><li><a class="tocitem" href="../../AMA/">🙋 Ask Me Anything</a></li><li><a class="tocitem" href="../../blogroll/">🔗 Blogroll</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Write Python in Lisp</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Write Python in Lisp</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/findmyway/TianJun.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/findmyway/TianJun.jl/blob/master/docs/src/essays/Write_Python_in_Lisp/index.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><hr/><p>keywords: Python,Lisp,Hylang CJKmainfont: KaiTi –-</p><h1 id="Write-Python-in-Lisp"><a class="docs-heading-anchor" href="#Write-Python-in-Lisp">Write Python in Lisp</a><a id="Write-Python-in-Lisp-1"></a><a class="docs-heading-anchor-permalink" href="#Write-Python-in-Lisp" title="Permalink"></a></h1><p>上周在Clojure微信群里，<a href="https://github.com/chanshunli">Steve Chan</a>分享了个关于<a href="https://github.com/hylang/hy">Hylang</a>的链接，让人眼前一亮，原来Python居然还可以这么写！经过这几天的摸索，意外地感觉不错，在这里推荐给大家试试，有兴趣的话可以看完官网的doc后再回来看下文。</p><h2 id="Hylang是什么？"><a class="docs-heading-anchor" href="#Hylang是什么？">Hylang是什么？</a><a id="Hylang是什么？-1"></a><a class="docs-heading-anchor-permalink" href="#Hylang是什么？" title="Permalink"></a></h2><p>Hy是基于python的lisp方言，与python的互操作非常顺畅，有点类似clojure于java的关系。从安装上可以看出，Hy实际上就是一个普通的python库，在python代码中可以直接<code>import hy</code>之后，把<code>.hy</code>文件当做普通的python文件，import其中的变量。核心代码部分，该有的也都有（最重要的当然是macro），可以从clojure无障碍迁移过来。</p><p>由于是直接把lisp代码转换成AST，开启<code>--spy</code>模式之后，可以看到每一行lisp代码转换之后的python代码，各种库的操作也完全没有障碍。试用了一些常用的库，基本没有什么大问题。目前感觉不是够顺畅的地方，反而是一些外围，比如没有很好的编辑环境。社区的vim插件提供的功能很弱，为此我特地入坑spacemacs！emacs对应的插件稍微好点，提供了发送代码到repl的功能，不过最重要的仍然是，没有代码补全，网上有人提供了一些静态的补全方案，通过提取hy库中的关键词和当前buffer中的变量名来补全（没有配置成功......），不过实际使用中会大量调用python库，因此急需像python里的anaconda-mode一类工具提供辅助补全。再比如静态语法检查，调试。</p><h2 id="Hylang不是......"><a class="docs-heading-anchor" href="#Hylang不是......">Hylang不是......</a><a id="Hylang不是......-1"></a><a class="docs-heading-anchor-permalink" href="#Hylang不是......" title="Permalink"></a></h2><h3 id="Hylang不是Clojure"><a class="docs-heading-anchor" href="#Hylang不是Clojure">Hylang不是Clojure</a><a id="Hylang不是Clojure-1"></a><a class="docs-heading-anchor-permalink" href="#Hylang不是Clojure" title="Permalink"></a></h3><p>这个是首先需要意识到的一点。尽管在语法和许多函数上和clojure很像，但是因为底层实现和语言的定位不一样，这其中的许多函数不再是clojure中对应函数的完整复制。以下列举一些很容易碰到的问题：</p><ol><li>muttable &amp; immutable. Hylang本身的定位是鼓励与python的互操作，因此大量的操作都是基于python本身的数据结构，需要非常小心数据随时都可能改变。在写Hylang代码的时候需要时刻提醒自己，“我写的是python代码！代码都会最终转换成python代码去执行！”，社区里最近也在讨论引入immutable的数据结构，不知道这块以后会怎么发展。</li><li>lazy. Hylang中大多数代码的lazy实现都是基于generators实现的了iterable，这下就蛋疼了。在python里，生成器访问一次之后，如果你不保存的话，数据就没有了......所以你会发现<code>(take n coll)</code>中，如果xs是一个iterable的数据，上面的代码执行多次是可能得到不同结果的。甚至如果不保存的话，没法访问已经被访问过的内容。不过好在0.12.0之后提供了lazy sequences，一定程度上缓解了这个问题。</li><li>in-place operations.在python中，许多函数都是默认in-place的，比如<code>sort</code>,<code>random.shuffle</code>等，有些可能提供了对应的非in-place的函数（如<code>sorted</code>），有些则没有。这点需要格外注意，否则，定义变量的时候很可能返回值就是个<code>None</code>。不过在<code>numpy</code>,<code>tensorflow</code>,<code>pandas</code>等库中，这点考虑得比较全面</li><li>scope. 看github上过去关于<code>let</code>绑定的issue，可以深入了解这块内容。在不确定变量名的scope时，可以看看对应的python代码。</li></ol><h2 id="体验过程中的一些坑"><a class="docs-heading-anchor" href="#体验过程中的一些坑">体验过程中的一些坑</a><a id="体验过程中的一些坑-1"></a><a class="docs-heading-anchor-permalink" href="#体验过程中的一些坑" title="Permalink"></a></h2><ol><li>文件名。写过了clojure的话会习惯<code>-</code>作为连接符，<code>hy</code>的文件名需要转换成<code>_</code>连接符，否则在python代码中不能import。</li><li>某些函数的的实现有bug。我自己在尝试的过程中就发现了<code>partition</code>函数的实现有点问题，在github上提了个issue。社区里的反应还是挺快的，第二天就解决并合并到master上了。</li><li>参数传递过程中，运用apply传递positional和named arguments时，需要分别用list和dict对二者封装，不能偷懒直接用一个list搞定。</li></ol><h2 id="Hylang适合写点什么？"><a class="docs-heading-anchor" href="#Hylang适合写点什么？">Hylang适合写点什么？</a><a id="Hylang适合写点什么？-1"></a><a class="docs-heading-anchor-permalink" href="#Hylang适合写点什么？" title="Permalink"></a></h2><p>写Hylang也就这几天，对macro的感受还不是很强烈，主要是写了点日常的数据分析代码和tensorflow中的tutorial，以下是一些个人感受：</p><ul><li>如果只是写一些调用API的代码，其实不太适合。比如我在翻译tensorflow的tutorial过程中，需要反复去查对应的API，很繁琐，而且已有的框架会在不知不觉中对写lisp风格的代码有一些限制，从而使得python代码更适合命令式地处理逻辑。</li><li>适合更抽象层的数据预处理逻辑。这块写起来会很舒服，对读代码和写代码的人来说，都是一种享受。可以将二者结合，这部分代码用hy处理后以接口的形式暴露给模型构建部分，最后再用hy糅合train,valid,test的过程。当然，现在某些库（tensorlayer）实际上把直接跟tensorflow打交道的部分做了很浅的一层封装，整体易用性更高了。</li></ul><p>最后，一点学习经验：</p><blockquote><p>When I’m learning something new, I sometimes find myself practicing EDD (exception-driven development). I try to evaluate some code, get an exception or error message, and then Google the error message to figure out what the heck happened. – <em>Mastering Clojure Macros</em></p></blockquote><p>另外，这个语言还是太小众了，玩玩就可以了，别太当真......</p></article><nav class="docs-footer"><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>. All contents published at this site follows <a href="https://creativecommons.org/licenses/by/4.0/">CC-BY-4.0</a> by default. For the Chinese version, please visit <a href="https://tianjun.me">tianjun.me</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="auto">Automatic (OS)</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.2.1 on <span class="colophon-date" title="Saturday 23 December 2023 15:51">Saturday 23 December 2023</span>. Using Julia version 1.9.4.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
